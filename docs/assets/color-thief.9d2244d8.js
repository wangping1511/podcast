if(!M)var M={map:function(a,u){var b={};return u?a.map(function(l,p){return b.index=p,u.call(b,l)}):a.slice()},naturalOrder:function(a,u){return a<u?-1:a>u?1:0},sum:function(a,u){var b={};return a.reduce(u?function(l,p,d){return b.index=d,l+u.call(b,p)}:function(l,p){return l+p},0)},max:function(a,u){return Math.max.apply(null,u?M.map(a,u):a)}};var A=function(){var a=5,u=8-a,b=1e3;function l(r,t,e){return(r<<2*a)+(t<<a)+e}function p(r){var t=[],e=!1;function s(){t.sort(r),e=!0}return{push:function(n){t.push(n),e=!1},peek:function(n){return e||s(),n===void 0&&(n=t.length-1),t[n]},pop:function(){return e||s(),t.pop()},size:function(){return t.length},map:function(n){return t.map(n)},debug:function(){return e||s(),t}}}function d(r,t,e,s,n,o,c){this.r1=r,this.r2=t,this.g1=e,this.g2=s,this.b1=n,this.b2=o,this.histo=c}function _(){this.vboxes=new p(function(r,t){return M.naturalOrder(r.vbox.count()*r.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function q(r,t){if(t.count()){var e=t.r2-t.r1+1,s=t.g2-t.g1+1,n=M.max([e,s,t.b2-t.b1+1]);if(t.count()==1)return[t.copy()];var o,c,f,h,v=0,g=[],m=[];if(n==e)for(o=t.r1;o<=t.r2;o++){for(h=0,c=t.g1;c<=t.g2;c++)for(f=t.b1;f<=t.b2;f++)h+=r[l(o,c,f)]||0;g[o]=v+=h}else if(n==s)for(o=t.g1;o<=t.g2;o++){for(h=0,c=t.r1;c<=t.r2;c++)for(f=t.b1;f<=t.b2;f++)h+=r[l(c,o,f)]||0;g[o]=v+=h}else for(o=t.b1;o<=t.b2;o++){for(h=0,c=t.r1;c<=t.r2;c++)for(f=t.g1;f<=t.g2;f++)h+=r[l(c,f,o)]||0;g[o]=v+=h}return g.forEach(function(w,x){m[x]=v-w}),function(w){var x,E,y,k,C,I=w+"1",z=w+"2",O=0;for(o=t[I];o<=t[z];o++)if(g[o]>v/2){for(y=t.copy(),k=t.copy(),C=(x=o-t[I])<=(E=t[z]-o)?Math.min(t[z]-1,~~(o+E/2)):Math.max(t[I],~~(o-1-x/2));!g[C];)C++;for(O=m[C];!O&&g[C-1];)O=m[--C];return y[z]=C,k[I]=y[z]+1,[y,k]}}(n==e?"r":n==s?"g":"b")}}return d.prototype={volume:function(r){return this._volume&&!r||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(r){var t=this.histo;if(!this._count_set||r){var e,s,n,o=0;for(e=this.r1;e<=this.r2;e++)for(s=this.g1;s<=this.g2;s++)for(n=this.b1;n<=this.b2;n++)o+=t[l(e,s,n)]||0;this._count=o,this._count_set=!0}return this._count},copy:function(){return new d(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(r){var t=this.histo;if(!this._avg||r){var e,s,n,o,c=0,f=1<<8-a,h=0,v=0,g=0;for(s=this.r1;s<=this.r2;s++)for(n=this.g1;n<=this.g2;n++)for(o=this.b1;o<=this.b2;o++)c+=e=t[l(s,n,o)]||0,h+=e*(s+.5)*f,v+=e*(n+.5)*f,g+=e*(o+.5)*f;this._avg=c?[~~(h/c),~~(v/c),~~(g/c)]:[~~(f*(this.r1+this.r2+1)/2),~~(f*(this.g1+this.g2+1)/2),~~(f*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(r){var t=r[0]>>u;return gval=r[1]>>u,bval=r[2]>>u,t>=this.r1&&t<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},_.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var t=this.vboxes,e=0;e<t.size();e++)if(t.peek(e).vbox.contains(r))return t.peek(e).color;return this.nearest(r)},nearest:function(r){for(var t,e,s,n=this.vboxes,o=0;o<n.size();o++)((e=Math.sqrt(Math.pow(r[0]-n.peek(o).color[0],2)+Math.pow(r[1]-n.peek(o).color[1],2)+Math.pow(r[2]-n.peek(o).color[2],2)))<t||t===void 0)&&(t=e,s=n.peek(o).color);return s},forcebw:function(){var r=this.vboxes;r.sort(function(n,o){return M.naturalOrder(M.sum(n.color),M.sum(o.color))});var t=r[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(r[0].color=[0,0,0]);var e=r.length-1,s=r[e].color;s[0]>251&&s[1]>251&&s[2]>251&&(r[e].color=[255,255,255])}},{quantize:function(r,t){if(!r.length||t<2||t>256)return!1;var e=function(h){var v,g=new Array(1<<3*a);return h.forEach(function(m){v=l(m[0]>>u,m[1]>>u,m[2]>>u),g[v]=(g[v]||0)+1}),g}(r);e.forEach(function(){});var s=function(h,v){var g,m,w,x=1e6,E=0,y=1e6,k=0,C=1e6,I=0;return h.forEach(function(z){(g=z[0]>>u)<x?x=g:g>E&&(E=g),(m=z[1]>>u)<y?y=m:m>k&&(k=m),(w=z[2]>>u)<C?C=w:w>I&&(I=w)}),new d(x,E,y,k,C,I,v)}(r,e),n=new p(function(h,v){return M.naturalOrder(h.count(),v.count())});function o(h,v){for(var g,m=h.size(),w=0;w<b;){if(m>=v||w++>b)return;if((g=h.pop()).count()){var x=q(e,g),E=x[0],y=x[1];if(!E)return;h.push(E),y&&(h.push(y),m++)}else h.push(g),w++}}n.push(s),o(n,.75*t);for(var c=new p(function(h,v){return M.naturalOrder(h.count()*h.volume(),v.count()*v.volume())});n.size();)c.push(n.pop());o(c,t);for(var f=new _;c.size();)f.push(c.pop());return f}}}().quantize,P=function(a){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=a.naturalWidth,this.height=this.canvas.height=a.naturalHeight,this.context.drawImage(a,0,0,this.width,this.height)};P.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var D=function(){};D.prototype.getColor=function(a,u){return u===void 0&&(u=10),this.getPalette(a,5,u)[0]},D.prototype.getPalette=function(a,u,b){var l=function(q){var r=q.colorCount,t=q.quality;if(r!==void 0&&Number.isInteger(r)){if(r===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");r=Math.max(r,2),r=Math.min(r,20)}else r=10;return(t===void 0||!Number.isInteger(t)||t<1)&&(t=10),{colorCount:r,quality:t}}({colorCount:u,quality:b}),p=new P(a),d=function(q,r,t){for(var e=q,s=[],n=0,o=void 0,c=void 0,f=void 0,h=void 0,v=void 0;n<r;n+=t)c=e[0+(o=4*n)],f=e[o+1],h=e[o+2],((v=e[o+3])===void 0||v>=125)&&(c>250&&f>250&&h>250||s.push([c,f,h]));return s}(p.getImageData().data,p.width*p.height,l.quality),_=A(d,l.colorCount);return _?_.palette():null},D.prototype.getColorFromUrl=function(a,u,b){var l=this,p=document.createElement("img");p.addEventListener("load",function(){var d=l.getPalette(p,5,b);u(d[0],a)}),p.src=a},D.prototype.getImageData=function(a,u){var b=new XMLHttpRequest;b.open("GET",a,!0),b.responseType="arraybuffer",b.onload=function(){if(this.status==200){var l=new Uint8Array(this.response);i=l.length;for(var p=new Array(i),d=0;d<l.length;d++)p[d]=String.fromCharCode(l[d]);var _=p.join(""),q=window.btoa(_);u("data:image/png;base64,"+q)}},b.send()},D.prototype.getColorAsync=function(a,u,b){var l=this;this.getImageData(a,function(p){var d=document.createElement("img");d.addEventListener("load",function(){var _=l.getPalette(d,5,b);u(_[0],this)}),d.src=p})};export{D as o};
